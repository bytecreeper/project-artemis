{% extends "base.html" %}
{% set active = "alerts" %}
{% block title %}Artemis â€” Alerts{% endblock %}

{% block content %}
<div x-data="alertsPage()" x-init="init()">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2 style="color: var(--amber); font-family: var(--font-mono); font-size: 16px;">[!] ALERTS</h2>
        <span class="mono" style="color: var(--text-muted);" x-text="alerts.length + ' open'"></span>
    </div>

    <template x-if="alerts.length === 0">
        <div class="card">
            <p style="color: var(--text-muted); padding: 20px; text-align: center;">No open alerts. All clear.</p>
        </div>
    </template>

    <template x-for="alert in alerts" :key="alert.id">
        <div class="card" style="border-left: 3px solid;" :style="'border-left-color:' + severityColor(alert.severity)">
            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                <div>
                    <h3 style="margin-bottom: 4px;" x-text="alert.title"></h3>
                    <p style="color: var(--text-secondary); font-size: 13px;" x-text="alert.description"></p>
                </div>
                <span class="badge" :class="severityClass(alert.severity)" x-text="severityLabel(alert.severity)"></span>
            </div>
            <div style="margin-top: 12px; font-size: 12px; color: var(--text-muted);">
                <span class="mono" x-text="alert.timestamp"></span>
                <span style="margin-left: 16px;" x-text="'Events: ' + (alert.event_ids?.length || 0)"></span>
            </div>
        </div>
    </template>
</div>
{% endblock %}

{% block scripts %}
<script>
function alertsPage() {
    return {
        alerts: [],
        async init() {
            await this.refresh();
            setInterval(() => this.refresh(), 10000);
        },
        async refresh() {
            try {
                this.alerts = await fetch('/api/alerts').then(r => r.json());
            } catch (e) { console.error(e); }
        },
        severityClass(s) { return ['low','low','medium','high','critical'][s] || 'low'; },
        severityLabel(s) { return ['INFO','LOW','MED','HIGH','CRIT'][s] || 'INFO'; },
        severityColor(s) { return ['#2ecc71','#2ecc71','#f1c40f','#f5a623','#e74c3c'][s] || '#2ecc71'; },
    };
}
</script>
{% endblock %}
