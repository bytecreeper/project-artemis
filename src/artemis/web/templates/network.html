{% extends "base.html" %}
{% set active = "network" %}
{% block title %}Artemis â€” Network{% endblock %}

{% block content %}
<div x-data="networkPage()" x-init="init()">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2 style="color: var(--amber); font-family: var(--font-mono); font-size: 16px;">[*] NETWORK</h2>
        <span class="mono" style="color: var(--text-muted);" x-text="hosts.length + ' hosts discovered'"></span>
    </div>

    <div class="card">
        <table>
            <thead>
                <tr>
                    <th>IP Address</th>
                    <th>MAC Address</th>
                    <th>Hostname</th>
                    <th>Open Ports</th>
                    <th>Last Seen</th>
                </tr>
            </thead>
            <tbody>
                <template x-if="hosts.length === 0">
                    <tr><td colspan="5" style="color: var(--text-muted); text-align: center; padding: 20px;">Scanning network...</td></tr>
                </template>
                <template x-for="host in hosts" :key="host.ip">
                    <tr>
                        <td class="mono" x-text="host.ip"></td>
                        <td class="mono" x-text="host.mac || '-'"></td>
                        <td x-text="host.hostname || '-'"></td>
                        <td class="mono" x-text="formatPorts(host.open_ports)"></td>
                        <td class="mono" x-text="host.last_seen || '-'"></td>
                    </tr>
                </template>
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function networkPage() {
    return {
        hosts: [],
        async init() {
            await this.refresh();
            setInterval(() => this.refresh(), 15000);
        },
        async refresh() {
            try { this.hosts = await fetch('/api/network/hosts').then(r => r.json()); }
            catch (e) { console.error(e); }
        },
        formatPorts(ports) {
            if (!ports) return 'none';
            if (typeof ports === 'string') { try { ports = JSON.parse(ports); } catch { return ports; } }
            return Array.isArray(ports) && ports.length > 0 ? ports.join(', ') : 'none';
        },
    };
}
</script>
{% endblock %}
